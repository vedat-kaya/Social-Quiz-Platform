{% extends "layout.html" %}
{% from "includes/_formhelpers.html" import render_field %}

{% block title %}Turnuva Havuzu | SorSana{% endblock %}

{% block head %}
<style>
    /* --- ULTIMATE STUDIO STİLİ --- */
    .studio-card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        min-height: 85vh;
        display: flex; flex-direction: column; overflow: hidden;
    }
    .studio-header {
        background-color: var(--bg-color); padding: 25px 40px;
        border-bottom: 1px solid var(--border-color);
        display: flex; justify-content: space-between; align-items: center;
    }
    .studio-header h3 { font-size: 1.6rem; font-weight: 800; color: var(--text-color); margin: 0; }
    .studio-body { flex-grow: 1; display: flex; flex-wrap: wrap; }

    /* SOL PANEL */
    .add-panel {
        background-color: var(--card-bg); padding: 40px;
        border-right: 1px solid var(--border-color);
        flex: 1; min-width: 350px; display: flex; flex-direction: column;
        overflow-y: auto; z-index: 2;
    }
    .panel-title { font-weight: 800; color: var(--primary-color); margin-bottom: 30px; display: flex; align-items: center; }
    .panel-title i { margin-right: 12px; background: rgba(255, 123, 0, 0.1); padding: 10px; border-radius: 10px; }

    .form-control-custom {
        background-color: var(--bg-color) !important;
        border: 1px solid var(--border-color) !important;
        color: var(--text-color) !important;
        border-radius: 12px; padding: 15px; font-size: 1rem;
    }

    .mini-upload-box {
        border: 2px dashed var(--border-color); border-radius: 16px;
        background-color: var(--bg-color); height: 180px;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        cursor: pointer; position: relative; transition: all 0.3s;
    }
    .mini-upload-box:hover { border-color: var(--primary-color); background-color: rgba(255, 123, 0, 0.03); }

    /* SAĞ PANEL */
    .preview-panel {
        padding: 40px; background-color: var(--bg-color);
        background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
        background-size: 20px 20px;
        flex: 1.5; overflow-y: auto; max-height: 85vh; min-width: 350px;
    }
    .item-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 25px; padding-bottom: 50px;
    }
    .item-card {
        border-radius: 16px; overflow: hidden; position: relative;
        box-shadow: 0 10px 25px rgba(0,0,0,0.08); aspect-ratio: 1 / 1.3;
        border: 1px solid var(--border-color); background: var(--card-bg);
    }
    .item-card:hover { transform: translateY(-8px); border-color: var(--primary-color); }
    .item-card img { width: 100%; height: 100%; object-fit: cover; }
    .item-overlay {
        position: absolute; bottom: 0; left: 0; right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
        padding: 20px 10px 15px 10px; color: white; font-weight: 700; text-align: center;
        pointer-events: none;
    }

    /* SİLME BUTONU */
    .btn-delete-item {
        position: absolute; top: 10px; right: 10px;
        width: 32px; height: 32px; border-radius: 50%;
        background-color: rgba(220, 53, 69, 0.9); color: white;
        border: none; display: flex; align-items: center; justify-content: center;
        cursor: pointer; opacity: 0; transform: scale(0.8); transition: all 0.2s; z-index: 10;
    }
    .item-card:hover .btn-delete-item { opacity: 1; transform: scale(1); }
    .btn-delete-item:hover { background-color: #dc3545; transform: scale(1.15); }

    .btn-add {
        background: linear-gradient(45deg, var(--primary-color), #ffaa00); color: white;
        border-radius: 12px; font-weight: bold; padding: 14px; width: 100%; border: none;
    }
    .btn-finish {
        margin-top: auto; background-color: #198754; color: white;
        border-radius: 50px; font-weight: 800; padding: 16px; text-align: center;
        display: block; text-decoration: none;
    }
    label { color: var(--text-color); margin-bottom: 8px; font-weight: 600; }
</style>
{% endblock %}

{% block body %}
<div class="row justify-content-center" style="margin-top: 2rem; margin-bottom: 3rem;">
    <div class="col-12 col-xl-11"> 
        <div class="card studio-card">
             
            <div class="studio-header">
                <div>
                    <h3 class="aralikli-baslik">{{ quiz_title }}</h3>
                    <small><i class="fa-solid fa-trophy text-warning"></i> Turnuva Aday Havuzu</small>
                </div>
                <div>
                    <span class="badge badge-warning p-2 px-3 text-dark font-weight-bold shadow-sm" style="border-radius: 10px;">
                        <i class="fa-solid fa-users"></i> {% if items %}{{ items|length }}{% else %}0{% endif %} Aday
                    </span>
                </div>
            </div>

            <div class="studio-body row no-gutters">
                <div class="col-md-4 add-panel">
                    <h5 class="panel-title"><i class="fa-solid fa-user-plus"></i> Aday Ekle</h5>
                     
                    <form method="post" enctype="multipart/form-data" style="display: flex; flex-direction: column; height: 100%;">
                        <div class="form-group mb-4">
                            <label class="small text-muted">ADAY İSMİ</label>
                            {{ render_field(form.item_name, class="form-control form-control-custom", placeholder="Örn: Batman") }}
                        </div>

                        <div class="form-group mb-4">
                            <label class="small text-muted">FOTOĞRAF</label>
                            <div class="mini-upload-box">
                                <i class="fa-solid fa-cloud-arrow-up fa-3x mb-3"></i>
                                <span class="font-weight-bold" style="color: var(--text-color);">Görsel Yükle</span>
                                <input type="file" name="item_image" required style="position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-add mt-2"><i class="fa-solid fa-plus-circle"></i> LİSTEYE EKLE</button>
                         
                        <div style="margin-top: auto;">
                            <hr class="my-4" style="border-color: var(--border-color);">
                            <a href="{{ url_for('publish_quiz_action', quiz_id=quiz_id) }}" class="btn btn-finish shadow">
                                <i class="fa-solid fa-rocket mr-2"></i> YAYINLA
                            </a>
                        </div>
                    </form>
                </div>

                <div class="col-md-8 preview-panel">
                    <h5 class="panel-title" style="justify-content: space-between; color: var(--text-color);">
                        <span><i class="fa-solid fa-users-viewfinder text-success"></i> Aday Kadrosu</span>
                    </h5>

                    {% if items %}
                        <div class="item-grid">
                            {% for item in items %}
                            <div class="item-card">
                                <img src="{{ url_for('static', filename='uploads/quiz_images/' + item.image_url) }}" alt="Seçenek">
                                 
                                <form action="{{ url_for('delete_pool_item', item_id=item.question_id) }}" method="POST" style="margin: 0;">
                                    {% if csrf_token %}
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                    {% endif %}
                                     
                                    <button type="submit" class="btn-delete-item" title="Sil">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                </form>

                                <div class="item-overlay">{{ item.question_text }}</div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center mt-5 p-5" style="border: 2px dashed var(--border-color); border-radius: 20px;">
                            <i class="fa-solid fa-layer-group fa-4x mb-3 text-muted" style="opacity: 0.3;"></i>
                            <h5 style="color: var(--text-color);">Havuz Bomboş!</h5>
                            <p class="text-muted">Turnuva için en az 2 aday eklemen gerekiyor.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock body %}